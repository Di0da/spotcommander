#!/bin/bash

PROJECT_PATH="$1"

QDBUS="$2"

NOWPLAYING=""

dbus-monitor --profile "type='signal',path='/org/mpris/MediaPlayer2',interface='org.freedesktop.DBus.Properties',member='PropertiesChanged'" | while read -r LINE; do

	if [[ ! "$LINE" =~ ^.+NameAcquired$ ]]; then

		if [ "$NOWPLAYING" != "$("$QDBUS" org.mpris.MediaPlayer2.spotify / org.freedesktop.MediaPlayer2.GetMetadata)" ]; then

			"$PROJECT_PATH"/bin/spotcommander-queue-play-next 1>/dev/null 2>&1

			sleep 1

		fi

		NOWPLAYING="$("$QDBUS" org.mpris.MediaPlayer2.spotify / org.freedesktop.MediaPlayer2.GetMetadata)"

	fi

done